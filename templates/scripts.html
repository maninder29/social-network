{% load staticfiles %}

<script src="{% static 'js/material.min.js' %}"></script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script type="text/javascript">
  $(".reply-btn").click(function(event){
    event.preventDefault();
    $(this).parent().parent().parent().parent().next(".comment-reply").fadeToggle();
  })

  $(".like-btn").click(function(event){
    event.preventDefault();
    var self = $(this);
    data={}
    $.ajax({
      url:self.attr("href"),
      type:'get',
      data:data,
      success: function(data){
        self.siblings('p.like-count').text(data.like_count+" likes")
        self.children('button').toggleClass('mdl-button--accent')
        console.log(data.like_count)
      },
      failure: function(response, error){
      	console.log(error)
       self.click();
      }
    })
  })

  $(".add-friend-btn").click(function(evnet){
    event.preventDefault();
    ctx={}
    $.ajax({
      url:$(".add-friend-btn").parent().attr("action"),
      type:'get',
      data:ctx,
      success: function(data){
        if (data.error) {
          var notification = document.querySelector('.mdl-js-snackbar');
          notification.MaterialSnackbar.showSnackbar({
            message: 'You are already friend of '+ data.to_username, timeout: 5000
          });
        } else{
          var notification = document.querySelector('.mdl-js-snackbar');
          notification.MaterialSnackbar.showSnackbar({
            message: 'Friend request sent successfully :)', timeout: 5000
          });
        }
      },
      failure: function(error){
        console.log(error)
        $(".add-friend-btn").click()
      }
    })
  })

  $(".follow-btn").click(function(evnet){
    event.preventDefault();
    ctx={}
    $.ajax({
      url:$(".follow-btn").parent().attr("action"),
      type:'get',
      data:ctx,
      success: function(data){
        if (data.error) {
          var notification = document.querySelector('.mdl-js-snackbar');
          notification.MaterialSnackbar.showSnackbar({
            message: 'You have already started following '+ data.followee_username
          });
        } else if (data.are_friends) {
          var notification = document.querySelector('.mdl-js-snackbar');
          notification.MaterialSnackbar.showSnackbar({
            message: 'You both are already friends'
          });
        } else {
          var notification = document.querySelector('.mdl-js-snackbar');
          notification.MaterialSnackbar.showSnackbar({
            message: 'You have successfully started following '+ data.followee_username
          });
        }
      },
      failure: function(error){
        console.log(error)
        $(".follow-btn").click()
      }
    })
  })

  $(".post-delete-btn").click(function(event){
    event.preventDefault();
    if (confirm("Are you sure?")) {
      window.location=$(".post-delete-btn").attr("href")
    }
  })
</script>